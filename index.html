<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blur Random Words</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            text-align: center;
            padding: 20px;
            height: 100%;
            margin: 0;
            background-color: #0c0c0c; /* Dark background */
            color: #ffffff; /* Light text color */
        }
        .hidden {
            display: none;
        }
        .lyrics-container {
            display: inline-block;
            text-align: left;
            font-size: 1.5em;
            line-height: 1.6;
            background: #1c1c1c; /* Darker container background */
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 800px;
            height: calc(100% - 150px);
            overflow-y: auto;
            white-space: pre-wrap;
            position: relative;
        }
        .blurred {
            filter: blur(5px);
            transition: filter 0.5s ease-in-out;
        }
        .unblurred {
            filter: blur(0);
            transition: filter 0.5s ease-in-out;
        }
        /* Class for correctly marked lines */
        .correct {
            color: #00ff00; /* Green text for correct lines */
        }
        /* Correct indicator styling: shows only the percentage with extra padding */
        .correct-indicator {
            font-size: 0.8em;
            border: 1px solid #00ff00;
            padding: 4px 6px;
            margin-left: 10px;
            border-radius: 3px;
        }
        button {
            margin-top: 10px;
            padding: 10px 15px;
            font-size: 1em;
            border: none;
            background: #5e5eff; /* Futuristic button color */
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #3b3bff;
        }
        textarea {
            width: 90%;
            max-width: 800px;
            height: 500px;
            margin-top: 15px;
            padding: 10px;
            font-size: 1.2em;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
            background-color: #2a2a2a;
            color: #e0e0e0;
        }
        .slider-container {
            margin-top: 10px;
        }
        .line {
            display: block;
            transition: filter 0.5s ease-in-out;
            padding: 5px 0;
        }
        .highlight {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #FF33FF; /* Bright color for highlight */
            left: 0;
            top: 60px; /* Set initial position */
            transform: translateY(-1.5em);
            transition: transform 0.3s ease-in-out;
        }
        /* 80s Futuristic Purple Moon Theme */
        .party-background {
            background: linear-gradient(to right, #6a0dad, #a020f0, #5c4d7a);
            background: linear-gradient(to bottom, #6A0DAF, #A020F0);
        }
        .button-primary {
            background-color: #5E5EFF; /* Button color */
            color: #FFFFFF; /* White text for buttons */
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            transition: background 0.3s;
        }
    </style>
</head>
<body class="party-background">
<!-- Input Phase -->
<div id="input-phase">
    <textarea id="inputLyrics" placeholder="Enter your lyrics here..."></textarea>
    <div class="slider-container">
        <label for="blurPercentage">Blur Percentage: <span id="blurValue">30</span>%</label>
        <input type="range" id="blurPercentage" min="10" max="100" value="30" oninput="updateBlurValue()">
    </div>
    <br>
    <button class="button-primary" onclick="startBlurring()">Blur Words</button>
</div>
<!-- Blurred Phase -->
<div id="blurred-phase" class="hidden">
    <div class="lyrics-container" id="lyrics-container">
        <div id="lyrics"></div>
        <div class="highlight" id="highlight"></div> <!-- Line position indicator -->
    </div>
    <br>
    <button class="button-primary" onclick="goBack()">Go Back</button>
</div>
<script>
    let currentLineIndex = -1; // Start above the first line
    let lines = [];
    let correctCount = 0; // Count of correctly marked lines

    function updateBlurValue() {
        document.getElementById("blurValue").innerText = document.getElementById("blurPercentage").value;
    }

    function startBlurring() {
        let inputText = document.getElementById("inputLyrics").value;
        let blurPercent = parseInt(document.getElementById("blurPercentage").value, 10);
        if (inputText.trim() === "") {
            alert("Please enter lyrics before blurring.");
            return;
        }
        // Reset correct count when starting a new session.
        correctCount = 0;
        lines = inputText.split("\n"); // Split into lines
        let processedLines = lines.map(line => {
            let words = line.split(/(\s+)/); // Preserve spaces
            let numBlurred = Math.floor(words.length * (blurPercent / 100));
            for (let i = 0; i < numBlurred; i++) {
                let index = Math.floor(Math.random() * words.length);
                if (words[index].trim() !== "") { // Avoid blurring spaces
                    words[index] = `<span class="blurred">${words[index]}</span>`;
                }
            }
            return `<span class="line">${words.join("")}</span>`;
        });
        document.getElementById("lyrics").innerHTML = processedLines.join("<br>");
        currentLineIndex = -1; // Start above the first line
        updateHighlightPosition();
        // Switch to Blurred Phase
        document.getElementById("input-phase").classList.add("hidden");
        document.getElementById("blurred-phase").classList.remove("hidden");
        document.addEventListener("keydown", handleKeyPress);
    }

    function goBack() {
        document.getElementById("input-phase").classList.remove("hidden");
        document.getElementById("blurred-phase").classList.add("hidden");
        document.removeEventListener("keydown", handleKeyPress);
    }

    function handleKeyPress(event) {
        // Use "s" for moving down, "w" for moving up, "Enter" for marking the current line, and "Space" for marking and moving down.
        if (event.key === "s") {
            event.preventDefault();
            moveHighlight(1);
        } else if (event.key === "w") {
            event.preventDefault();
            moveHighlight(-1);
        } else if (event.key === "Enter") {
            event.preventDefault();
            markCurrentLineCorrect();
        } else if (event.key === " ") {
            event.preventDefault();
            markCurrentLineCorrect(); // Mark current line
            moveHighlight(1); // Move to next line
        }
    }

    function moveHighlight(direction) {
        let lineElements = [...document.querySelectorAll(".line")].filter(line => line.innerText);
        if (currentLineIndex + direction >= -1 && currentLineIndex + direction < lineElements.length) {
            if (currentLineIndex >= 0 && direction === -1) {
                // When moving up, re-blur words in the previously highlighted line.
                lineElements[currentLineIndex].querySelectorAll(".unblurred").forEach(word => {
                    word.classList.remove("unblurred");
                    word.classList.add("blurred");
                });
            }
            currentLineIndex += direction;
            updateHighlightPosition();
            if (currentLineIndex >= 0) {
                lineElements[currentLineIndex].querySelectorAll(".blurred").forEach(word => {
                    word.classList.remove("blurred");
                    word.classList.add("unblurred");
                });
            }
        }
    }

    function updateHighlightPosition() {
        let lineElements = [...document.querySelectorAll(".line")].filter(line => line.innerText);
        let lyricsContainer = document.getElementById("lyrics-container");
        let highlight = document.getElementById("highlight");
        if (currentLineIndex === -1) {
            highlight.style.transform = `translateY(-1.5em)`; // Start above the first line
            lyricsContainer.scrollTop = 0; // Scroll to the top
        } else if (lineElements.length > 0) {
            let targetLine = lineElements[currentLineIndex];
            let offset = targetLine.offsetTop - lyricsContainer.offsetTop; // Calculate the top offset of the target line
            highlight.style.transform = `translateY(${offset}px)`; // Move the highlight to the target line
            // Scroll to center the target line in the container
            // let containerHeight = lyricsContainer.clientHeight;
            // let targetCenter = offset + targetLine.clientHeight / 2;
            // lyricsContainer.scrollTop = targetCenter - containerHeight / 2;\

            window.scrollTo({
                top: targetLine.offsetTop - 200,
                left: 0,
                behavior: "smooth",
            })
        }
    }

    function markCurrentLineCorrect() {
        let lineElements = [...document.querySelectorAll(".line")].filter(line => line.innerText);
        if (currentLineIndex >= 0 && currentLineIndex < lineElements.length) {
            let currentLine = lineElements[currentLineIndex];
            // Toggle marking: if already marked, unmark it.
            if (currentLine.classList.contains("correct")) {
                currentLine.classList.remove("correct");
                let indicator = currentLine.querySelector(".correct-indicator");
                if (indicator) {
                    indicator.remove();
                }
                correctCount--;
            } else {
                currentLine.classList.add("correct");
                correctCount++;
                let totalLines = lineElements.length;
                let percentage = Math.round((correctCount / totalLines) * 100);
                let indicatorSpan = document.createElement("span");
                indicatorSpan.classList.add("correct-indicator");
                indicatorSpan.innerHTML = `<strong>${percentage}% correct</strong>`;
                currentLine.appendChild(indicatorSpan);
            }
        }
    }
</script>
</body>
</html>